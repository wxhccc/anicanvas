{"version":3,"file":"index.es5.js","sources":["index.js"],"sourcesContent":["/*全局变量，用于存rem单位*/\r\n\r\n$(function(){\r\n  \r\n\tlet t,\r\n      app = new Invitation('#J-wrap');\r\n  $(window).resize(function(){\r\n    clearTimeout(t);\r\n    t = setTimeout(function(){\r\n      app.resize();\r\n    },500)\r\n    \r\n  });  \r\n});\r\n\r\n\r\nfunction getPageSize(){\r\n  return {width: $(window).width(), height: $(window).height()};\r\n}\r\n\r\n/*页面逻辑类*/\r\nclass Invitation{\r\n  constructor(elem){\r\n    this.envInit();\r\n    this.AC = new Anicanvas(elem, {...this.fullPageSize}); \r\n    this.pageInit();\r\n  }\r\n  envInit() {\r\n  \tthis.fullPageSize = getPageSize();\r\n  \tthis.rem = this.fullPageSize.width / 15;\r\n  }\r\n  resize(){\r\n  \tthis.envInit();\r\n  \tthis.AC.resize();\r\n  }\r\n  pageInit(){\r\n    /*\r\n    * 业务逻辑部分\r\n    */\r\n    //创建背景层\r\n    this.AC.createStage('background', {zIndex: 100});\r\n    this.AC.start();\r\n    //this.AC.$stage.pause();\r\n    //this.AC.$stages['background'].pause();\r\n    this.loadingMedia();\r\n    //this.test();\r\n  }\r\n  /*预加载资源*/\r\n  loadingMedia(){\r\n  \tlet preload_media = {\r\n      'images': {'bg1':'./img/bg.jpg','music':'./img/music.png','p1_01':'./img/p1_01.png','p1_02_01':'./img/p1_02_01.png','p1_02_02':'./img/p1_02_02.png','arrow':'./img/arrow.png','p1_03_01':'./img/p1_03_01.png','p1_03_02':'./img/p1_03_02.png','p1_03_03':'./img/p1_03_03.png'},\r\n      'audios':{'m1':'./media/bgm.mp3'}\r\n    };\r\n  \tthis.AC.loadingMedia(preload_media, this.drawPage);\r\n    this.drawLoadinProgress();\r\n  }\r\n  /*绘制进度条*/\r\n  drawLoadinProgress(){\r\n  \tlet rem = this.rem;\r\n  \tlet {height} = this.fullPageSize;\r\n  \tlet bgPainter = new Anicanvas.Painter( function(sprite, ctx, time, fdelta, data){\r\n  \t\tlet {left, top, width, height} = sprite;\r\n  \t\tctx.save();\r\n  \t\tctx.fillStyle = '#efefef';\r\n  \t\tctx.fillRect(left, top, width, height);\r\n  \t\tctx.restore();\r\n  \t});\r\n  \tlet layer = this.AC.createLayer('progLayer', 'fullpage', bgPainter);\r\n\r\n  \tlet progbarPaniter = new Anicanvas.Painter( (sprite, ctx, time, fdelta, data) => {\r\n  \t\tlet {left, top, width, height, $data: {percent}} = sprite;\r\n  \t\tctx.save();\r\n  \t\tctx.fillStyle = '#aeaeae';\r\n  \t\tctx.fillRect(left, top, width, height);\r\n  \t\tctx.fillStyle = '#999999';\r\n  \t\tctx.fillRect(left, top, width * percent / 100, height);\r\n  \t\tctx.restore();\r\n  \t});\r\n    let progresUpdate = {\r\n      'update': {\r\n        execute: (sprite, time)=>{\r\n          let mediaload = this.AC.$media.getImageProgress();\r\n          let percent = mediaload[2];\r\n          sprite.$data.percent = percent;\r\n          sprite.updated = true;\r\n          (percent === 100) && (layer.destroy = true);\r\n        }\r\n      }\r\n    }\r\n  \tlet progressBar = new Anicanvas.Sprite('progbar', {left: 1*rem, top: height-40, width: 13*rem, height: 20}, progbarPaniter, progresUpdate);\r\n  \tlayer.append(progressBar);\r\n  \tthis.AC.$stages['background'].append(layer);\r\n  }\r\n\r\n  drawPage = () => {\r\n    let rem = this.rem,\r\n    \t\tcanvasSize = this.fullPageSize,\r\n    \t\t{ $media: {images, audios}, createLayer, append } = this.AC,\r\n    \t\tpageLayer = createLayer('page', 'fullpage', new Anicanvas.ImagePainter(images['bg1']));\r\n    \r\n    /*音乐播放按钮*/\r\n    let musicIcoPainter = new Anicanvas.ImagePainter(images['music']);\r\n    musicIcoPainter.addQueueFn('rotate');\r\n    let musicIco = new Anicanvas.Sprite('music', {\r\n\t    \ttop: 0.5 * rem, \r\n\t    \tleft: 0.865 * 15 * rem,\r\n\t    \twidth: 1.2 * rem,\r\n\t    \theight: 1.2 * rem,\r\n\t    \trotateVelocity: -45,\r\n\t    },\r\n    \tmusicIcoPainter, {\r\n      \t'rotate': {\r\n        \texecute : function(sprite, time, fdelta, data, context){\r\n          \tsprite.rotate = (sprite.rotate + fdelta/1000 * sprite.rotateVelocity ) % 360;\r\n        \t}\r\n      \t}\r\n    });\r\n    musicIco.$media.music = audios['m1'];\r\n    musicIco.setPath(function(context){\r\n      context.arc(this.left+this.width/2, this.top+this.height/2, 0, 2*Math.PI);\r\n    });\r\n    musicIco.$media.play('music');\r\n    \r\n    \r\n      \r\n    /*对话框*/\r\n    let dailogPainter = new Anicanvas.Painter((sprite,context,time,fdelta,data) => {\r\n      if(sprite.$data.photo){\r\n        dailogPainter.putPhoto(sprite, context);\r\n      }\r\n      else{\r\n        let dailog = images['p1_01'];\r\n        context.save();\r\n        if(sprite.opacity < 1){\r\n          context.globalAlpha = sprite.opacity > 0 ? sprite.opacity : 0;\r\n        }\r\n        context.drawImage(dailog, 0, 0, dailog.width, 398, sprite.left, sprite.top, sprite.width, sprite.height);\r\n        if(time > 2500){  \r\n        \tcontext.drawImage(dailog, 0, 400, dailog.width, 129, sprite.left, sprite.top+sprite.height*0.2513, sprite.width, sprite.height*0.3241);\r\n          dailogPainter.getPhoto(sprite, context);\r\n        }\r\n        context.restore();\r\n      }\r\n    });\r\n    let dailog = new Anicanvas.Sprite('dailog', {\r\n    \t\ttop: -20, \r\n    \t\tleft: 2.64*rem, \r\n    \t\topacity: 0, \r\n    \t\twidth: 8.8*rem, \r\n    \t\theight: 6.76*rem\r\n    \t},\r\n    \tdailogPainter, {\r\n      \t'slideFadeDown' : new Anicanvas.Behavior({\r\n      \t\tname: 'slideFadeDown',\r\n      \t\ttiming: 'ease',\r\n      \t\tduration: 800,\r\n      \t\tdelay: 700, \r\n      \t\tfillMode: 'forward', \r\n      \t\tanimation:{ top:'+=20', opacity: 1}\r\n      \t})\r\n    \t}\r\n    );\r\n    \r\n      \r\n    /*箭头动画*/\r\n    let arrowSlide = new Anicanvas.Behavior({\r\n    \tname: 'slideUpRepeat',\r\n    \tduration:2500,\r\n    \tdelay: 100,\r\n    \titeration: 'infinite',\r\n    \tanimation: {\r\n    \t\t0: {top: '+=8', opacity: 0},\r\n    \t\t30: {top: '-=3', opacity:1},\r\n    \t\t100: {top: '-=10', opacity:0}\r\n    \t}\r\n    });\r\n    let arrow = new Anicanvas.Sprite('arrow',{top:canvasSize.height-2*rem+8,left:6.92*rem,width:1.16*rem,opacity:0,height:1.16*rem},new Anicanvas.ImagePainter(images['arrow']),{'slideUpRepeat':arrowSlide})\r\n    \r\n\r\n      \r\n    /*背景*/\r\n    let midBgPanter = {\r\n      paint:(sprite,context,time,data)=>{\r\n        let midbg = sprite.$data.img;\r\n        if(midbg) {\r\n        \tcontext.save();\r\n\t        if(sprite.opacity < 1){\r\n\t          context.globalAlpha = sprite.opacity > 0 ? sprite.opacity : 0;\r\n\t        }\r\n\t        sprite.top += sprite.velocityY * data;  \r\n\t        context.drawImage(midbg,0,0,midbg.width,midbg.height,sprite.left,sprite.top + 20,sprite.width,sprite.height);\r\n\t        context.restore();\r\n        }\r\n      }\r\n    };\r\n    let midBgBehaviors = {\r\n      'slideUp':{\r\n      \tdistance: -20, duration:800, delay:2500,\r\n        execute : function(sprite, time){\r\n          sprite.$data.img = images['p1_02_01'];\r\n          let deltat = time - sprite._startTime - this.delay;\r\n          if(deltat > 0){\r\n            sprite.velocityY = this.distance / this.duration;\r\n            let opacity = deltat / this.duration;\r\n            if(deltat >= 800){\r\n              sprite.velocityY = 0;\r\n              opacity = 1;\r\n              delete sprite.behaviors.slideUp;\r\n            }\r\n            sprite.opacity = opacity > 1 ? 1 : opacity;\r\n          }\r\n        }\r\n      },\r\n      'bgswitch':{\r\n      \tdelay: 3500,\r\n        execute : function(sprite, time){\r\n          let deltat = time - sprite._startTime - this.delay;\r\n          if(deltat > 0){\r\n            let skipt = deltat % 1000;\r\n            if(skipt < 500){\r\n              sprite.$data.img = images['p1_02_01'];\r\n            }\r\n            else{\r\n              sprite.$data.img = images['p1_02_02'];\r\n            }\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    let midBgLayer = new Anicanvas.Layer('midbg', {top: 6.96*rem+20, left:0.52*rem, width:13.52*rem, opacity:0, height:12.7*rem, data: {img:null}}, midBgPanter, midBgBehaviors);\r\n    /*人物*/\r\n    let peopleCell = [{x:0,y:0,w:268,h:384},{x:270,y:0,w:268,h:384},{x:540,y:0,w:268,h:384},{x:810,y:0,w:268,h:384}],\r\n        peoplePainter = new Anicanvas.SheetPainter(images['p1_03_01'], peopleCell, {interval:500, autoruning:true, iteration:'infinite'})\r\n    let people = new Anicanvas.Sprite('people', {left:2.2*rem,top:6.27*rem, width:10.72*rem,opacity:0,height:15.36*rem}, peoplePainter);\r\n\r\n    /*固定图片*/\r\n    let customPainter = {\r\n      paint:function(sprite,context,time,data){\r\n        let img = sprite.$data.img;\r\n        img && context.drawImage(img, 0, 0, img.width, img.height, sprite.left, sprite.top, sprite.width, sprite.height);\r\n      }\r\n    };\r\n    let floor = new Anicanvas.Sprite('floor', {top:19.31*rem, left:2.745*rem, width:10.56*rem, height:2.88*rem, $data:{ img: images['p1_03_03']}}, customPainter);\r\n    let desc = new Anicanvas.Sprite('desc', {top:14.275*rem, left:3.84*rem, width:7.02*rem, height:5.12*rem, $data:{img: images['p1_03_02']}}, customPainter);\r\n\r\n\r\n\r\n    this.AC.append(musicIco, midBgLayer, arrow, people, desc);\r\n\r\n    pageLayer.append(dailog);\r\n    pageLayer.append(floor);\r\n    this.AC.$stages['background'].append(pageLayer);\r\n      \r\n  }\r\n  test(){\r\n    let {rem} = this;\r\n\r\n    /*测试代码*/\r\n    let ballRoll = {\r\n      execute: (sprite, time)=>{\r\n        let {left, top, width, height} = sprite;\r\n        let {left: pleft, top: ptop, width: pwidth, height: pheight} = sprite.$parent;\r\n        if(left < pleft || left > pleft + pwidth - width) {\r\n          sprite.left = left < pleft? pleft : pleft + pwidth - width;\r\n          sprite.velocityX = -sprite.velocityX;\r\n        }\r\n        else if( top < ptop || top > ptop + pheight -height) {\r\n          sprite.top = top < ptop ? ptop : ptop + pheight -height;\r\n          sprite.velocityY = -sprite.velocityY;\r\n        }\r\n        sprite.left += sprite.velocityX;\r\n        sprite.top += sprite.velocityY;\r\n        sprite.rotatePoint = {x: sprite.left + sprite.width/2, y: sprite.top + sprite.height / 2};\r\n      }\r\n    };\r\n    let {width: swidth, height: sheight} = this.AC.$stage._stage;\r\n    for(let i = 0; i< 1; i++){\r\n      let width = 10 + Math.random() * 30;\r\n      let left = Math.random() * swidth - width;\r\n      let top = Math.random() * swidth - width;\r\n      let velocityX = Math.random() * 20;\r\n      let velocityY = Math.random() * 20;\r\n      let opacity = 0.2 + Math.random() * 0.8;\r\n      let ballPainter = new Anicanvas.Painter((sprite, context, time, fdelta)=>{\r\n        console.log(this.AC.frameRate);\r\n        let { rotatePoint: {x, y}} = sprite; //\r\n        context.save();\r\n        context.beginPath();\r\n        context.globalAlpha = sprite.opacity;\r\n        context.fillStyle = \"red\";\r\n        context.arc(x, y, width / 2, 0, Math.PI*2);\r\n        context.fill();\r\n        context.restore();\r\n      })\r\n      let ball = new Anicanvas.Sprite('ball'+i, {left, top, width, height: width, opacity, velocityX, velocityY}, ballPainter, {ballRoll})\r\n      this.AC.append(ball);\r\n    }\r\n\r\n  }\r\n  \r\n}\r\n\r\n\r\n\r\n"],"names":["$","t","app","Invitation","window","resize","clearTimeout","setTimeout","getPageSize","width","height","elem","drawPage","rem","canvasSize","fullPageSize","AC","$media","images","audios","createLayer","append","pageLayer","Anicanvas","ImagePainter","musicIcoPainter","addQueueFn","musicIco","Sprite","top","left","rotateVelocity","execute","sprite","time","fdelta","data","context","rotate","music","setPath","arc","Math","PI","play","dailogPainter","Painter","$data","photo","putPhoto","dailog","save","opacity","globalAlpha","drawImage","getPhoto","restore","Behavior","name","timing","duration","delay","fillMode","animation","arrowSlide","iteration","arrow","midBgPanter","paint","midbg","img","velocityY","midBgBehaviors","distance","deltat","_startTime","behaviors","slideUp","skipt","midBgLayer","Layer","peopleCell","x","y","w","h","peoplePainter","SheetPainter","interval","autoruning","people","customPainter","floor","desc","$stages","envInit","pageInit","createStage","zIndex","start","loadingMedia","preload_media","drawLoadinProgress","bgPainter","ctx","fillStyle","fillRect","layer","progbarPaniter","percent","progresUpdate","mediaload","getImageProgress","updated","destroy","progressBar","ballRoll","$parent","pleft","ptop","pwidth","pheight","velocityX","rotatePoint","$stage","_stage","swidth","sheight","i","random","ballPainter","console","log","frameRate","beginPath","fill","ball"],"mappings":"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"}