!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Anicanvas=e()}(this,function(){"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),i=function t(e,i,n){null===e&&(e=Function.prototype);var a=Object.getOwnPropertyDescriptor(e,i);if(void 0===a){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,n)}if("value"in a)return a.value;var o=a.get;return void 0!==o?o.call(n):void 0},n=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},s=function(){function i(){t(this,i)}return e(i,[{key:"play",value:function(t){this[t]&&this[t].play&&this[t].play()}},{key:"pause",value:function(t){this[t]&&this[t].pause&&this[t].pause()}}]),i}();function o(t,e,i){var n={};return r(t,"object")&&r(e,"array")&&e.forEach(function(e){t.hasOwnProperty(e)?n[e]=t[e]:i&&(n[e]=void 0)}),n}function r(t,e){return"string"==typeof e?Object.prototype.toString.call(t).toLowerCase()==="[object "+e.toLowerCase()+"]":null}function u(t){return(r(t,"number")||r(t,"string"))&&!isNaN(t-parseFloat(t))}function h(t,e){return JSON.stringify(t)===JSON.stringify(e)}function l(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.sort(function(t,n){return void 0!==t[e]&&void 0!==n[e]?t[e]<n[e]?i?1:-1:t[e]>n[e]?i?-1:1:0:0})}function c(t){console.log(t)}var f={top:0,left:0,width:0,height:0,velocityX:0,velocityY:0,rotateVelocity:0,rotate:0,opacity:1,visible:!0,animating:!1,zindex:0,destroy:!1,rotatePoint:{x:0,y:0}},v=function(){function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t(this,i),this._startTime=0,this._autoRP=!0,this._updated=!1,this.$data={},this.$media=new s,this.TYPE="sprite",this.name=e,this._painter=a,this.behaviors=r(o,"object")?o:{},this.injectRelevantProps(),this.initArgs(n)}return e(i,[{key:"initArgs",value:function(t){Object.assign(this,t),!this.needAutoRP&&(this.rotatePoint=this._spriteRP())}},{key:"injectRelevantProps",value:function(){var t=this;Object.keys(f).forEach(function(e){var i=f[e],n=t;Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:function(){return i},set:function(t){n.needAutoRP&&n._checkAutoRp(e,t),t===i||h(t,i)||(i=t,n.needAutoRP&&n._autoRotatePoint(e),n.updated=!0)}})})}},{key:"_checkAutoRp",value:function(t,e){"rotatePoint"===t&&r(e,"object")&&(e.auto?delete e.auto:this._autoRP=!1)}},{key:"_autoRotatePoint",value:function(t){this.needAutoRP&&this._autoRP&&["left","top","width","height"].indexOf(t)>=0&&(this.rotatePoint=this._spriteRP(!0))}},{key:"_spriteRP",value:function(t){var e={x:this.left+this.width/2,y:this.top+this.height/2};return t&&(e.auto=!0),e}},{key:"setPath",value:function(t){r(t,"function")&&(this.path=t)}},{key:"paint",value:function(t,e,i,n){if(this._painter&&this._painter.paint&&this.visible){var a=this.$parent||{left:0,top:0},s=a.left,o=a.top;t.save(),t.translate(s,o),this._painter.paint(this,t,e,i,n),t.restore()}}},{key:"update",value:function(t,e,i,n){this.updated=!1,!this._startTime&&(this._startTime=t),this._runBehaviors(t,e,i,n),this.updated&&(n.isStatic=!1)}},{key:"_runBehaviors",value:function(t,e,i,n){var a=this.behaviors,s=this._startTime,o=!0,u=!1,h=void 0;try{for(var l,c=Object.keys(a)[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var f=a[l.value];if(f.delay){if(t-s-f.delay<0)continue;t=t-s-f.delay}r(f.execute,"function")&&f.execute(this,t,e,i,n)}}catch(t){u=!0,h=t}finally{try{!o&&c.return&&c.return()}finally{if(u)throw h}}}}]),i}(),p=function(s){function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t(this,o);var r=a(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e,i,n,s));return r.TYPE="layer",r.children=[],r}return n(o,v),e(o,[{key:"paint",value:function(t,e,n,a){i(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"paint",this).call(this,t,e,n,a),this.children.forEach(function(i){return i.paint&&i.paint(t,e,n)})}},{key:"update",value:function(t,e,n,a){i(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"update",this).call(this,t,e,n,a),this.children.forEach(function(i,s,o){i.destroy&&o.splice(s,1),i.update&&i.update(t,e,n,a)})}},{key:"append",value:function(){for(var t=this,e=this.children,i=arguments.length,n=Array(i),a=0;a<i;a++)n[a]=arguments[a];e.push.apply(e,n),n.forEach(function(e){return e.$parent=t}),l(e,"zindex")}}]),o}(),d=function(s){function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t(this,o),a(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,"BASELAYER-"+e,i))}return n(o,p),e(o,[{key:"update",value:function(t,e,n,a){a.isStatic=!0,i(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"update",this).call(this,t,e,n,a)}},{key:"paint",value:function(t,e,n,a){if(!t.isStatic){var s=this.width,r=this.height;t.clearRect(0,0,s,r),i(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"paint",this).call(this,t,e,n,a)}}}]),o}(),g=function(){function i(e,n){var a=this;t(this,i),this._playing=!0,this.update=function(t,e,i){if(a._playing){var n=a._ctx;a._stage.update(t,e,i,n),a._stage.paint(n,t,e,i)}},this.append=function(){var t;(t=a._stage).append.apply(t,arguments)},this.$canvas=this.elemInit(e,n),this.resetOptions(n,!0),this.stageInit(e),this.$layers={}}return e(i,[{key:"resetOptions",value:function(t,e){e||!this._options?this._options=Object.assign({},t):Object.assign(this._options,t)}},{key:"elemInit",value:function(t,e){var i=o(e,["width","height"]),n=Object.assign({},e,{position:"absolute"}),a=r(t,"string")?function(t,e,i){var n=document.createElement(t);return r(e,"object")&&Object.assign(n,e),r(i,"object")&&Object.assign(n.style,i),n}("canvas",i,n):t;return(a=r(a,"HTMLCanvasElement")?a:null)&&(a.id="AC_"+t),a}},{key:"stageInit",value:function(t){var e=o(this._options,["width","height"]);this._stage=new d(t,e),this.$canvas?this._ctx=this.$canvas.getContext("2d"):c("no accessable canvas element!")}},{key:"play",value:function(){this._playing=!0}},{key:"pause",value:function(){this._playing=!1}},{key:"setCanvasSize",value:function(){var t=this._options,e=t.width,i=t.height;u(e)&&u(i)&&Object.assign(this.$canvas,{width:e,height:i})}},{key:"resize",value:function(){this.setCanvasSize()}}]),i}(),m={top:0,left:0,width:0,height:0,velocityX:0,velocityY:0,rotateVelocity:0,rotate:0,opacity:1,visible:!0,animating:!1,zindex:0,destroy:!1,rotatePoint:{x:0,y:0}},y=function(){function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t(this,i),this._startTime=0,this._autoRP=!0,this._updated=!1,this.$data={},this.$media=new s,this.TYPE="sprite",this.name=e,this._painter=a,this.behaviors=r(o,"object")?o:{},this.injectRelevantProps(),this.initArgs(n)}return e(i,[{key:"initArgs",value:function(t){Object.assign(this,t),!this.needAutoRP&&(this.rotatePoint=this._spriteRP())}},{key:"injectRelevantProps",value:function(){var t=this;Object.keys(m).forEach(function(e){var i=m[e],n=t;Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:function(){return i},set:function(t){n.needAutoRP&&n._checkAutoRp(e,t),t===i||h(t,i)||(i=t,n.needAutoRP&&n._autoRotatePoint(e),n.updated=!0)}})})}},{key:"_checkAutoRp",value:function(t,e){"rotatePoint"===t&&r(e,"object")&&(e.auto?delete e.auto:this._autoRP=!1)}},{key:"_autoRotatePoint",value:function(t){this.needAutoRP&&this._autoRP&&["left","top","width","height"].indexOf(t)>=0&&(this.rotatePoint=this._spriteRP(!0))}},{key:"_spriteRP",value:function(t){var e={x:this.left+this.width/2,y:this.top+this.height/2};return t&&(e.auto=!0),e}},{key:"setPath",value:function(t){r(t,"function")&&(this.path=t)}},{key:"paint",value:function(t,e,i,n){if(this._painter&&this._painter.paint&&this.visible){var a=this.$parent||{left:0,top:0},s=a.left,o=a.top;t.save(),t.translate(s,o),this._painter.paint(this,t,e,i,n),t.restore()}}},{key:"update",value:function(t,e,i,n){this.updated=!1,!this._startTime&&(this._startTime=t),this._runBehaviors(t,e,i,n),this.updated&&(n.isStatic=!1)}},{key:"_runBehaviors",value:function(t,e,i,n){var a=this.behaviors,s=this._startTime,o=!0,u=!1,h=void 0;try{for(var l,c=Object.keys(a)[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var f=a[l.value];if(f.delay){if(t-s-f.delay<0)continue;t=t-s-f.delay}r(f.execute,"function")&&f.execute(this,t,e,i,n)}}catch(t){u=!0,h=t}finally{try{!o&&c.return&&c.return()}finally{if(u)throw h}}}}]),i}(),_=function(){function i(e){t(this,i),this.image=null,this.paint_queue=[],this.photo=null,r(e,"function")&&(this.paint=e.bind(this))}return e(i,[{key:"paint",value:function(t,e,i,n,a){}},{key:"addQueueFn",value:function(t){var e=r(t,"function")?t:r(this[t],"function")?this[t]:null;e&&this.paint_queue.push(e)}},{key:"clearQueue",value:function(){this.paint_queue=[]}},{key:"runQueue",value:function(t,e,i,n,a){for(var s=this.paint_queue,o=0;o<s.length;o++)s[o](t,e,i,n,a)}},{key:"_setSelfStyles",value:function(t,e){t.opacity<1&&(e.globalAlpha=t.opacity>0?t.opacity:0)}},{key:"rotate",value:function(t,e,i,n,a){var s;e.translate(t.rotatePoint.x,t.rotatePoint.y),e.rotate((s=t.rotate,Math.PI/180*s)),t.left=-t.width/2,t.top=-t.height/2}},{key:"getPhoto",value:function(t,e){t.data.photo=e.getImageData(t.left,t.top,t.width,t.height)}},{key:"putPhoto",value:function(t,e){e.putImageData(t.data.photo,t.left,t.top)}}]),i}(),k=function(i){function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments[1];t(this,s);var n=a(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return n.image=e,n.imgSet=i||{x:0,y:0,w:e&&e.width,h:e&&e.height},n}return n(s,_),e(s,[{key:"paint",value:function(t,e,i,n,a){if(this.image){e.save();var s=Object.assign({},t);this._setSelfStyles(s,e),this.runQueue(s,e,i,n,a);var o=this.imgSet;e.drawImage(this.image,o.x,o.y,o.w,o.h,s.left,s.top,s.width,s.height),e.restore()}}}]),s}(),b=function(i){function s(e,i,n){var o=n.interval,r=void 0===o?1e3:o,u=n.autoruning,h=void 0!==u&&u,l=n.iteration,c=void 0===l?1:l,f=n.reverse,v=void 0!==f&&f;t(this,s);var p=a(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return p.image=e,p.cells=i,p.reverse=v,p.cell_index=v?p.cells.length-1:0,p.interval=r,p.running=!!h,p.frame_point=0,p.timeline=0,p.iteration="infinite"==c?c:parseInt(c),p._countFramePoint(p.cell_index),p}return n(s,_),e(s,[{key:"advance",value:function(){(this.reverse?1==this.cell_index:this.cell_index==this.cells.length-2)&&(this.frame_point=this.timeline=0,Number.isInteger(this.iteration)&&this.iteration--),this.reverse?this.cell_index+=this.cells.length-1:this.cell_index++,this.cell_index%=this.cells.length,this._countFramePoint(this.cell_index)}},{key:"_countFramePoint",value:function(t){var e=(this.reverse?t+this.cells.length-1:t+1)%this.cells.length;this.frame_point+=this._sValue(this.cells[e].interval,this.interval)}},{key:"skip",value:function(t){this.cell_index=t%this.cells.length}},{key:"paint",value:function(t,e,i,n,a){if(this.running){(this.iteration>0||"infinite"==this.iteration)&&this.timeline>=this.frame_point&&this.advance();var s=this.cells[this.cell_index],o=s.img?this.image[s.img]:this.image,r=this._sValue;e.save(),e.drawImage(o,s.x,s.y,s.w,s.h,r(s.sl,t.left),r(s.st,t.top),r(s.sw,t.width),r(s.sh,t.height)),this.timeline+=n,e.restore()}}},{key:"_sValue",value:function(t,e){return Number.isFinite(t)?t:e}}]),s}(),P=function(){function i(e){t(this,i),this._animation=r(e,"function")?e:function(){},this.startTime=0,this.lastTime=0,this.running=!1,this._playing=!1,this.time=0,this.elapsed=0,this.frameRate=0,this._lastFRupdate=0,this._animHandle=null}return e(i,[{key:"updateFrameRate",value:function(t,e){t-this._lastFRupdate>1e3&&(this._lastFRupdate=t,this.frameRate=Math.round(1e3/e))}},{key:"start",value:function(){var t=this;if(!this.running){this.startTime=+new Date,this.running=!0,this.play();this._animHandle=window.requestAnimationFrame(function e(i){t._playing&&(!t.lastTime&&(t.lastTime=i),t.time=i-t.lastTime,t.elapsed+=t.time,t.lastTime=i,t.updateFrameRate(t.elapsed,t.time),t._animation(t.elapsed,t.time)),t._animHandle=window.requestAnimationFrame(e)})}}},{key:"play",value:function(){this._playing=!0}},{key:"pause",value:function(){this.lastTime=0,this.frameRate=0,this._playing=!1}},{key:"stop",value:function(){this.elapsed=+new Date-this.startTime,this.running=!1,this.frameRate=0,window.cancelAnimationFrame(this._animHandle)}},{key:"getElapsedTime",value:function(){return this.running?+new Date-this.startTime:this.elapsed}},{key:"getRuningTime",value:function(){return this.time}},{key:"getNextTime",value:function(){var t=this.time/this.duration;if(this.running)return void 0==this.timeWrap?elapsedTime:elapsedTime*(this.timeWarp(t)/t)}},{key:"isRunning",value:function(){return this.running}},{key:"reset",value:function(){this.elapsed=0}}],[{key:"getWarpTime",value:function(t,e,i){if("function"==typeof t){var n=e/i;return e*t(n)/n}}},{key:"easeIn",value:function(t){return function(e){return Math.pow(e,2*t)}}},{key:"easeOut",value:function(t){return function(e){return 1-Math.pow(1-e,2*t)}}},{key:"easeInOut",value:function(){return function(t){return t-Math.sin(2*t*Math.PI)/(2*Math.PI)}}},{key:"elastic",value:function(t){return t=t||this.def_opts.elastic_passes,function(e){return(1-Math.cos(e*Math.PI*t))*(1-e)+e}}},{key:"bounce",value:function(t){var e=i.elastic(t);return function(){return percent_complete=e(percent_complete),percent_complete<=1?percent_complete:2-percent_complete}}},{key:"linear",value:function(){return function(t){return t}}},{key:"step",value:function(){return function(t){return t}}}]),i}(),w=function(){function i(e,n){t(this,i);Object.assign(this,{firstFn:null,animation:null,iteration:1,timing:null,fillMode:null},e),this.executeFn=r(n,"function")?n:this.animation?this._attrChange:function(){},this.timing=r(this.timing,"function")?this.timing:r(P[this.timing],"function")?P[this.timing](this.timingArgs):null,this.firstFn=r(this.firstFn,"function")?this.firstFn:function(){},this._firstRun=!1,this._iterationCount=0,this._spriteAttrs={},this._animaProps=this._animaInitProps(),this._animaRuntime=null}return e(i,[{key:"_animaInitProps",value:function(){return{velocity:(t={left:0,top:0,rotate:0,width:0,height:0,opacity:0},e="rotate",i=0,e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t),lastFrame:0,frameDuration:0,framesTime:[]};var t,e,i}},{key:"execute",value:function(t,e,i,n,a){this._firstRun||(this._remeberAttrs(t),this._animationPrepare(t),this.firstFn(),this._iterationCount++,this._firstRun=!0);var s=Math.floor(e/this.duration);if(s===this._iterationCount&&(this._checkIterationCount(s)&&(this._iterationCount++,this._animationPrepare(t)),"forward"!==this.fillMode&&this._remeberAttrs(t,!0)),this._checkIterationCount(s)){if(e%=this.duration,this.animation){var o=this._animaRuntime,u=this.animation,h=o.framesTime[0];if(e>=this._countFrameDuration(h)){var l=o.lastFrame=o.framesTime.shift();h=o.framesTime[0],o.frameDuration=this._countFrameDuration(h-l),o.velocity=this._attrChangeInit(t,u[h],o.frameDuration)}if(this.timing&&o.frameDuration){var c=this._warpTime(e,o.frameDuration);e=c[0],i=c[1]}}else if(this.timing&&this.duration){var f=this._warpTime(e,this.duration);e=f[0],i=f[1]}this.executeFn(t,e,i,n,a)}else r(this.animateCallback,"function")&&this.animateCallback(t,a),delete t.behaviors[this.name]}},{key:"_countFrameDuration",value:function(t){return t*this.duration/100}},{key:"_checkIterationCount",value:function(t){return"infinite"===this.iteration||t<this.iteration}},{key:"_animationPrepare",value:function(t){if(this.animation){this._setAnimaData(),!this.animation[0]&&!this.animation[100]&&(this.animation={0:null,100:this.animation});var e=this.animation,i=this._animaRuntime;for(var n in e)0===n&&e[0]&&this._spriteAttrSet(t,e[0],!0),i.framesTime.push(n);i.framesTime.sort(function(t,e){return t-e})}}},{key:"_setAnimaData",value:function(){this._animaRuntime=this._animaInitProps()}},{key:"_warpTime",value:function(t,e){var i=t/e,n=this.timing(i)/i*t;!this.lastTime&&(this.lastTime=n);var a=n-this.lastTime;return this.lastTime=n,this.orgTime=[n,a],this.orgTime}},{key:"_attrChangeInit",value:function(t,e,i){var n={};for(var a in e){var s=e[a],o=0;o="string"==typeof s?this._handleRelativeValue(s):s-t[a],n[a]=o/i}return n}},{key:"_attrChange",value:function(t,e,i,n,a){var s=this._animaRuntime.velocity;for(var o in s)t[o]+=s[o]*i}},{key:"_spriteAttrSet",value:function(t,e,i){for(var n in e)t[n]=i?this._handleRelativeValue(e[n],t[n]):e[n]}},{key:"_handleRelativeValue",value:function(t,e){var i=0;if("string"==typeof t&&t.indexOf("=")>0){var n=t.split("=");switch(n[0]){case"+":i=n[1]-0;break;case"-":i=-n[1]}}return u(e)&&(i+=e),i}},{key:"_remeberAttrs",value:function(t,e){if(1===Object.keys(t.behaviors).length&&(this.iteration>1||"infinite"===this.iteration)){var i=this._spriteAttrs,n=this._animaProps.velocity;if(0===Object.keys(i).length&&!e)for(var a in n)i[a]=t[a];e&&i&&this._spriteAttrSet(t,i)}}}]),i}(),O=function(){function i(){var e=this;t(this,i),this.loadImage=function(t,i,n,a){e.loadMedias("images",t,i,n,a)},this.getImageProgress=function(){return e.getProgress("images")},this.loadAudio=function(t,i,n,a){e.loadMedias("audios",t,i,n,a)},this.getAudioProgress=function(){return e.getProgress("audios")},this.getMediaProgress=function(){var t=e.imagesInfo.queue,i=e.audiosInfo.queue,n=i.s+i.f+t.s+t.f,a=i.t+t.t;return[n,a,Math.round(n/a*100)]},this.imagesInfo=this._mediaInfoObj(),this.images={},this.audiosInfo=this._mediaInfoObj(),this.audios={}}return e(i,[{key:"_mediaInfoObj",value:function(){return{total:{s:0,f:0,t:0},queue:{s:0,f:0,t:0},urls:[]}}},{key:"loadingMedia",value:function(t,e){return this.loadingImages(t.images||{},e,!0),this.loadingAudios(t.audios||{},e,!0),this}},{key:"loadingMediaList",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=!!Array.isArray(e),s=this[t+"Info"],o=null;if("images"===t?o=this.loadImage:"audios"===t&&(o=this.loadAudio),e&&s&&o)for(var r in s.queue={s:0,f:0,t:0},e){o(a?e[r]:r,e[r],i,n)}return this}},{key:"loadingImages",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.loadingMediaList("images",t,e,i)}},{key:"loadMedias",value:function(t,e,i,n,a){var s=this[t+"Info"];if(Array.indexOf(s.urls,i)<0){s.total.t++,s.queue.t++,s.urls.push(i);var o=a&&this.getMediaProgress,r=null,u="load";"images"===t?(r=new Image,!a&&(o=this.getImageProgress)):"audios"===t&&(r=new Audio,!a&&(o=this.getAudioProgress),u="loadedmetadata"),r&&(r.addEventListener(u,function(){s.total.s++,s.queue.s++,100==o()[2]&&n()}),r.addEventListener("error",function(){s.total.f++,s.queue.f++,100==o()[2]&&n()}),r.src=i,this[t][e]=r)}}},{key:"loadingAudios",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.loadingMediaList("audios",t,e,i)}},{key:"getProgress",value:function(t){var e=this[t+"Info"].queue,i=e.s+e.f,n=Math.round(i/e.t*100);return[i,e.t,n]}}]),i}(),R=function(){function i(e,n){t(this,i),j.call(this),this._elem=this.elemInit(e),this._options=Object.assign({},n),this._aniTimer=new P(this.animation),this.stageInit()}return e(i,[{key:"elemInit",value:function(t){return r(t,"string")?document.querySelector(t):null}},{key:"stageInit",value:function(){if(this._elem){var t=this._options,e=t.width,i=t.height;this.createStage("MAIN",{width:e,height:i,zIndex:1e3}),this.$stage=this.$stages.MAIN}else c("no accessable root element!")}},{key:"createStage",value:function(t,e){if(r(t,"string")&&!this.$stages[t]){var i=this._options,n=i.width,a=i.height;!e.width&&(e.width=n),!e.height&&(e.height=a);var s=new g(t,e);this.$stages[t]=s,this._stages.push(s),l(this._stages,"zIndex"),this._elem.appendChild(s.$canvas)}}},{key:"start",value:function(){this._aniTimer.start()}},{key:"play",value:function(){this._aniTimer.play()}},{key:"pause",value:function(){this._aniTimer.pause()}},{key:"stop",value:function(){this._aniTimer.stop()}},{key:"setCanvasSize",value:function(){var t=this._options,e=t.width,i=t.height;u(e)&&u(i)&&Object.assign(this.canvas,{width:e,height:i})}},{key:"loadingMedia",value:function(t,e){(t.images||t.audios)&&this.$media.loadingMedia(t,e)}},{key:"createPainter",value:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];switch(t){case"image":return new k([].concat(i));case"sheet":return new b([].concat(i));default:return new _(t)}}},{key:"resize",value:function(t){r(t,"object")&&Object.assign(this._elem,t)}},{key:"frameRate",get:function(){return this._aniTimer.frameRate}}]),i}();R.Sprite=y,R.Layer=p,R.Painter=_,R.ImagePainter=k,R.SheetPainter=b,R.Behavior=w;var j=function(){var t=this;this._RAF=0,this._stages=[],this.$stages={},this.$stage=null,this.$layers={},this.$media=new O,this.animation=function(e,i){t._stages.forEach(function(t){return t.update(e,i)})},this.createLayer=function(e,i,n){if(r(e,"string")){var a=null;return r(i,"function")?n=i:a="fullpage"===i?{width:t._options.width,height:t._options.height}:i,t.$layers[e]=new p(e,a,n),t.$layers[e]}},this.append=function(){var e;(e=t.$stage).append.apply(e,arguments)}};return R});
